<div class="minicart">
    <div class="minicart-title">
      <div>Your Cart - item</div>
      <button class="cart-cancel">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    {% if cart.item_count > 0 %}
      <form
        action="/cart"
        method="post"
        class="minicart-product-list">

          <div class="minicart-product" data-key="{{ item.key }}">
            <div id="minicart-product" ></div>
          </div>

          <div class="minicart-note">
            <div>Add a note to your order</div>
            <textarea
              name="noteOrder"
              rows="3"
              cols="25"></textarea>
          </div>

          <div class="minicart-detail">
            <div class="minicart-detail-total">
              <strong>Subtotal</strong>
              <span class="cart__total-price">{{ cart.total_price | money }}</span>
            </div>
            <button
              class="button"
              type="submit"
              name="checkout">Checkout</button>
          </div>
      </form>
    {% else %}
      <div style="text-align:center; margin:auto; margin-top: 30px;">Cart is empty</div>
    {% endif %}
    {%- comment -%} <input type="submit" name="checkout" value="Checkout"> {%- endcomment -%}
    </div>

<script>
  document.querySelectorAll('.qtybox .btnqty').forEach(button => {
    button.addEventListener('click', () => {
      const input = button.parentElement.querySelector('input');
      const value = Number(input.value);
      const isPlus = button.classList.contains('.qtyplus');
      const key = button.closest('.minicart-product').getAttribute('data-key');

      if (isPlus) {
        const newValue = value + 1;
        input.value = newValue;
        changeItemQuantity(key, newValue);
      } else if (value > 1) {
        const newValue = value - 1;
        input.value = newValue;
        changeItemQuantity(key, newValue);
      }
    });
  });

  function changeItemQuantity(key, quantity) {
    
  }
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
  $(document).ready(function() {
      // Fetch the initial contents of the cart
      fetchCart();

      // Set an interval to fetch the contents of the cart every 5 seconds
      setInterval(fetchCart, 1000);
  });

  function fetchCart() {
    $.ajax({
      url: '/cart.js',
      type: 'GET',
      dataType: 'json',
      success: function(cart) {
        // Extract the items from the cart object
        var items = cart.items;

        // Clear the contents of the cart div before adding the updated contents
        $('#minicart-product').empty();

        // Loop through each item and output the product image, title, quantity, and price
        for (var i = 0; i < items.length; i++) {
          var item = items[i];
          var productImage = item.featured_image.url;
          var productTitle = item.product_title;
          var quantity = item.quantity;
          var productPrice = item.final_price;
          $('#minicart-product').append(
            '<div class="minicart-product-image">'
              '<a href="' + item.url + '>' +
                '<img src="' + item.featured_image.url + '">' +
              '</a>' +
            '</div>' +

            '<div class="minicart-product-description">' +
              '<div class="flex-direction-column">' +
                '<div class="minicart-product-title">' +
                  '<a href="' + item.url +'">' +
                    item.product_title +
                    '<br>' +
                    '( ' item.variant_title ' )' +
                  '</a>' +
                '</div>' +

                '<div class="qtydiv">' +
                  '<div class="qtybox">' +
                    '<button class="btnqty qtyminus icon icon-minus">-</button>' +
                    '<input type="number" id="updates_' + item.key + '" name="updates[]" value="' + item.quantity + '" min="1" class="quantity-selector quantity-input">' +
                    '<button class="btnqty qtyplus icon icon-plus">+</button>' +
                  '</div>' +

                  '<div class="rmvbtn">' +
                  '</div>' +
                '</div>' +
              '</div>' +

              '<div class="minicart-product-price">' +
                item.final_price +
              '</div>' +
            '</div>'
          );
        }
      },
      error: function() {
        console.log('Error loading cart.');
      }
    });
  };
</script>