{% assign collection = collections['all'] %}
{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_image = current_variant.featured_image | default: product.featured_image %}

<div id="quantity-product-id"></div>

<div class="mx-auto mb-28">
  <div class="lg:border border-black border-t border-x-0 lg:!w-[1024px]">
    <div class="flex flex-col lg:flex-row px-[10px] mt-[3.5rem] gap-y-3 w-[100%] border-b lg:border-b-0 border-black pb-[20px] lg:pb-0">
      <div class="flex flex-row lg:w-[20%]">
        <h1 class="text-4xl font-bold">{{ collection.title }}</h1>
        <button class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>

      <div class="flex flex-row lg:w-[80%] justify-between">
        <div class="flex flex-row gap-x-2">
          <a class="" href="javascript&colon;history.back()">
            <div class="border border-black py-[3px] px-[8px] h-[32px]">BACK</div>
          </a>
          <a href="{{ paginate.next.url }}">
            <div class="border border-black py-[3px] px-[8px] h-[32px]">NEXT</div>
          </a>
        </div>
        <div class="flex flex-row gap-x-2">
          <div id="cartbtn" class="border border-black py-[3px] px-[8px] h-[32px] cursor-pointer">
            <a>CART</a>
          </div>
          <div class="buckscc-currency-box border border-black py-[3px] px-[8px] h-[32px]"></div>
        </div>
      </div>
    </div>

    <div class="flex lg:flex-row lg:p-[10px] lg:w-[100%] mt-0">
      <div class="hide lg:flex w-[20%] border border-black" id="navbarProduct">
        <nav role="navigation">
          {% for link in linklists.main-menu.links %}
            <div class="widget-left-bar">
              <a href="/" {% if link.active %}aria-current="page"{% endif %}>
                <h2 class="text-3xl font-bold">{{ link.title }}</h2>
              </a>
              {% if link.links != blank %}
                <ul class="product-list">
                  {% for child_link in link.links %}
                    <li>
                      <a href="{{ child_link.url }}" {% if child_link.active %}aria-current="page"{% endif %}>
                        {{ child_link.title }}
                      </a>
                      {% if child_link.links != blank %}
                        <ul>
                          {% for grandchild_link in child_link.links %}
                            <li>
                              <a href="{{ grandchild_link.url }}" {% if grandchild_link.active %}aria-current="page"{% endif %}>
                                {{ grandchild_link.title }}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>
          {% endfor %}
        </nav>
      </div>

      <div class="lg:w-[80%] border-b border-black lg:border lg:border-s-0">
        <div class="mobile-product-page">
          <div class="sub-left-bar">
            <div class="gap-1">
            {% if product.selected_or_first_available_variant.featured_image %}
              {%  assign featured = product.selected_or_first_available_variant.featured_image %}
              <img id="product-image" src="{{ featured | image_url }}"/>
            {% else %}
              {%  assign featured = product.featured_image %}
              <img id="product-image" src="{{ featured | image_url }}"/>
            {% endif %}
              
              <ul class="product-image-thumbs gap-[10px] mt-[10px]">
                {%  for image in product.images %}  
                  <li class="{% if image == featured %}selected{% endif %}"><img src="{{ image | image_url: master }}"/></li>
                {% endfor %}
              </ul>
            </div>
          </div>
          <div class="sub-right-bar">
            <div class="gap-1">
              <h1 class="text-4xl font-bold">{{ product.title }}</h1>
              <div class="product-prices" id="product-prices">
                {% comment  %}
                  <p class="product-compare {% if product.selected_or_first_available_variant.compare_at_price <= product.selected_or_first_available_variant.price %} hide {% endif %} ">
                    {{ product.selected_or_first_available_variant.compare_at_price | money }}
                  </p>
                {% endcomment %}
                {% if product.compare_at_price > product.price %}
                  <p class="product-price"></p>
                    <p class="compare-price">{{ product.selected_or_first_available_variant.compare_at_price | money }}</p>
                    <br>
                    <p class="original-price">{{ product.selected_or_first_available_variant.price | money }}</p>
                  </p>
                {% else %}
                  <p class="product-price">
                    {{ product.selected_or_first_available_variant.price | money }}
                  </p>
                {% endif %}
              </div>
              <div>{{ product.description }}</div>

              {% form 'product', product %}
                <input id="product-id" type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

                {% if product.variants.size > 1 %}
                <div class="flex flex-wrap justify-center">
                  {% for option in product.options_with_values %}
                    <fieldset style="display: flex; border: none; flex-direction;flex-flow: inherit;">
                      {% for value in option.values %}
                        {% assign variant = product.variants | where: option.name, value | first %}
                        <div class="product-variant">
                          <input
                            {% if option.selected_value == value %}checked="checked"{% endif %}
                            type="radio"
                            name="{{ option.name }}"
                            value="{{ value }}"
                            id="{{ option.name | handleize }}-{{ value | handleize }}"
                          {% comment %}
                        {% unless product.variants[].available %}disabled{% endunless %}
                          {% endcomment %}>
                          <label for="{{ option.name | handleize }}-{{ value | handleize }}">
                            {{ value }}
                          </label>
                        </div>
                      {% endfor %}
                    </fieldset>
                  {% endfor %}
                </div>
                {% endif %}

                <div id="quantity-product-id"></div>

                <div class="hide">
                  <label for="quantity">Quantity</label>
                  <input
                    id="quantity"
                    name="quantity"
                    value="1"
                    class="product-quantity">
                </div>

                <button class="py-[7px] w-full mt-[20px] mb-[40px] border border-black text-lg font-semibold" {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %} type="submit" id="AddToCart">
                  {% if product.selected_or_first_available_variant.available %}
                    Add to Cart
                  {% else %}
                    Out of Stock
                  {% endif %}
                </button>
              {% endform %}


            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex lg:flex-row flex-col-reverse justify-between px-[10px] pb-[10px] items-center gap-4 lg:gap-0">
      <script>
        $(document).ready(function() {
          // Double-check the ID of the footer element:
          var footerElement = $('#footerPages');

          // Check if the element exists before appending:
          if (footerElement.length > 0) {
            var captureUrlWindows = window.location.origin; // Use location.origin for the domain

            // Clear existing content if needed (replace with .append() to add after):
            footerElement.html(
              '<a href="' + captureUrlWindows + '/pages/about">About</a>' +
              '<a>•</a>' +
              '<a href="' + captureUrlWindows + '/pages/privacy-policy">Privacy & Policy</a>' +
              '<a>•</a>' +
              '<a href="' + captureUrlWindows + '/pages/terms-conditions">Terms & Conditions</a>' +
              '<a>•</a>' +
              '<a href="' + captureUrlWindows + '/pages/contact">Contact</a>'
            );
          } else {
            console.error("Element with ID '#footerPages' not found.");
          }
        });
      </script>
      <div id="footerPages" class="flex flex-row gap-[5px]">
      </div>
      <div class="">
        <div class="page-number">{{ paginate | default_pagination: next: ' ', previous: ' ' }}</div>
      </div>
    </div>
  </div>
</div>

<script>
  var product = {{ product | json }};

  // variant product handler
  document.querySelectorAll('.product-option input[type="radio"]').forEach(radio => {
    // disable options with quantity 0
    radio.addEventListener('change', () => {

      // find selection option
      var selectedOptions = [];

      document.querySelectorAll('.product-option input[type="radio"]:checked').forEach(radio => {
        selectedOptions.push(radio.value);
      })

      // finding the matched variant
      var matchedVariant = product.variants.find(variant => {
        var pass = true;

        for (var i = 0; i < selectedOptions.length; i++) {
          if (selectedOptions.indexOf(variant.options[i]) === -1) {
            pass = false;
            break;
          }
        }
        return pass;
      })

      // change product form variant id
      document.querySelector('#product-id').value = matchedVariant.id;

      // change url for variant
      var url = new URLParse(window.location.href, true);
      url.query.variant = matchedVariant.id;
      window.history.replaceState(null, null, url.toString());

      // change button
      var add = document.querySelector("#AddToCart")

      if (matchedVariant.available){
        add.textContent = "Add to Cart"
        add.disabled = false
      } else {
        add.textContent = "Out of Stock"
        add.disabled = true
      }
    })
  })
  
  // image product handler
  document.querySelectorAll('.product-image-thumbs li').forEach(li => {
    li.addEventListener('click', () => {
      document.querySelector('.product-image-thumbs li.selected').classList.remove('selected')
      li.classList.add('selected')

      document.querySelector('#product-image').setAttribute('src', li.querySelector('img').getAttribute('src'))
    })
  })

  // change url to /cart page
  document.addEventListener('DOMContentLoaded', function() {
    var addToCartButton = document.querySelector('#AddToCart');
    addToCartButton.addEventListener('click', function(event) {
      window.onload = function() {
        // Delay the reload for a second
        setTimeout(function() {
          minicart.classList.toggle('is-active');
          //location.reload();
        }, 0);
      };
      
    });
  });

  // variant product out of stock
  //
  
</script>